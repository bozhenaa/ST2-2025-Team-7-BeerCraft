BeerCraftMVC

1. Обща концепция 
BeerCraft е уеб приложение, разработено с ASP.NET Core MVC и служи като платформа за ентусиасти в домашното пивоварство. То предоставя на потребителите следните функционалности:
- Създаване и споделяне на рецепти: Потребителите създават собствени рецепти за бира, като описват съставките и инструкции и ги предоставят публично на общността,
- с възможност за интеракция под формата на харесване на рецепта. 
- Управление на личен инвентар: Всеки потребител поддържа личен списък на съставките, с които разполага. 
- AI Асистент чатбот: Предоставяне на съвети за рецепти или съставки, използвайки локално свързан езиков модел (LLM) - Ollama

2. Технологии и архитектура
Следните принципи и технологии се срещат в проекта:

-- Технологичен стек:
 - ASP.NET Core MVC: Основната структура на уеб приложението е Model-View-Controller.
 - Entity Framework Core: За обектно-релационен мапинг и комуникация с базата данни.
 - База данни: Program.cs конфигурира приложението да използва SQLite.
 - HTML/CSS/JavaScript: За структурата, стилизацията и интерактивността на потребителския интерфейс.
-- Аутентикация:
 - Cookie Authentication
 - Бисквитките за вход са настроени да изтичат след 7 дни
 - Логин и изход пътища. 
	- 
-- Design Patterns:
 - MVC: Основен архитектурен шаблон, разделящ приложението на три компонента - models(entities), views, controllers
 - Repository Pattern: Контролерите не комуникират директно с BeerCraftDbContext. Вместо това зависят от интерфейси (IUserRepository, IRecipeRepository), 
	- които се инжектират като услуги в Program.cs. 
	- Целта е да се абстрахира достъпа до данни, да се улесни тестването и да позволи бързата смяна на източника на данни.
 - Data Transfer Object Pattern: Приложението използва ViewModels, които служат за пренос на данни между контролерите и изгледите. 
	- Това помага да се избегне излагането на деликатни данни от моделите на базата (Entities) и да се подават само необходимите такива към изгледа.
 - Singleton Pattern: Използва се за LLMService, за да гарантира, че съществува само една инстанция на услугата, която управлява конфигурацията на локалния езиков модел.
 - Dependency Injection: управлява services, зависимости, които се инжектират в конструкторите на класовете.
 - Unit of Work: BeerCraftDbContext следи всички промени по обектите, изпълняват се в една транзакция чрез SaveChangesAsync().
 -	

3. Структура на базата данни - Базата се дефинира в BeerCraftDbContext.cs и включва:
-- Основните таблици / Entities:
 - Users: Потребителите
 - Recipes: Рецептите
 - Ingredients: Конкретни съставки
 - IngredientTypes: Типове съставки
 - Charactesistics: Характеристики на съставките
 - Inventories: Наличностите на потребителите
-- Свързващи таблици / Entities:
 - LikedRecipes: Свързва Users и Recipes, за да следи кои потребители кои рецепти са харесали
 - UserRecipes: Свързва Users и Recipes, за да следи създадените рецепти
 - RecipeIngridients: Свърза Recipes и Ingredients, като описва количеството и мерната единица за всяка рецепта
 - IngredientCharacteristics: Свързва Ingredients с техниte Characteristics
-- Ключови връзки и композитни ключове за OnModelCreating
 - RecipeIngredient - RecipeId, IngredientId,
 - LikedRecipe: UserId, RecipeId,
 - IngredientCharacteristic: IngredientId, CharacteristicId,
 - Inventory: UserId, IngredientId
-- Дефинирано е правилото: Един потребител не може да бъде изтрит, ако има създадени рецепти в системата

4. Функционалности в контролерите:
-- Account Controller - управлява цялата логика за потребителски акаунти, профили и аутентикация
 - [GET] Access: Показва страница за вход и регистрация
 - [GET] EditProfile: Показва форма за редакция на профила
 - [GET] Profile: Достъпен за логнати потребители, извлича пълната информация чрез ID-то на текущия 
 - [POST] Register: Валидира модела, проверява подадените данни, хешира паролата чрез BCrypt, създава нов User обект, записва се в базата чрез репозиторито (.AddAsync), логва потребителя.
 - [POST] Login: Валидира моделя, проверява потребителя, ако данните са верни го логва.
 - [POST] Logout: Изход на потребителя чрез HttpContext.SignOutAsync
 потребител. Подава данните към ProfileViewModel, зарежда изгледа.
 - [POST] EditProfile: Обработва промените в профила, като позволява актуализиране на името. 

-- Recipe Controller - управлява създаването, преглеждането, търсенето и управлението на рецепти
 - [GET] Index: Показва списък с всички рецепти, като позволява филтриране чрез searchTerm. Извлича имената на авторите и проверява дали текущият логнат потребител е харесал всяка от рецептите.
 - [GET] Create: (Изисква аутентикация) Показва формата за създаване на нова рецепта. Зарежда списък с наличните съставки (PopulateDropdowns).
 - [GET] Details: Показва детайлна информация за избрана рецепта, включително нейните съставки и автора. Проверява дали текущият логнат потребител е харесал тази рецепта (IsLikedByCurrentUser).
 - [GET] Delete: (Изисква аутентикация) Изтрива рецепта. Преди да изтрие, проверява дали текущият потребител е автор на рецептата (recipe.CreatedByUserId != userId). Ако не е, връща Forbid().
 - [GET] SearchSuggestion: AJAX ендпойнт, който връща бързи предложения (JSON) за рецепти при въвеждане на текст в полето за търсене.
 - [POST] Create: (Изисква аутентикация) Обработва данните от формата за създаване. Извършва валидация, за да провери дали има добавена поне една съставка и дали няма дублирани съставки. 
	- Ако моделът е валиден, записва новата рецепта и нейните RecipeIngredients в базата данни чрез _recipeRepository.
 - [POST] LikeRecipe: (Изисква аутентикация) Позволява на потребител да хареса или да отхареса рецепта. Ако "харесване" не съществува, го създава; ако съществува, 
	- го премахва от таблицата LikedRecipes.
 
-- Inventory Controller - управлява личния инвентар със съставки на потребителя
 - [GET] Index: Показва основния изглед на инвентара, който включва списък с настоящите съставки на потребителя и комбинирана форма за добавяне на нови.
 - [POST] Create: Обработва добавянето на артикул към инвентара. Това действие има два сценария:
	1. Добавяне на съществуваща съставка: Ако потребителят избере съставка от списъка (addForm.IngredientId > 0).
	2. Създаване на нова съставка: Ако addForm.IngredientId == -1, контролерът проверява дали съставка с въведеното име (NewIngredientName) вече съществува, за да избегне дублажи.
	1. Ако не съществува, създава нов Ingredient обект в базата данни.
След като finalIngredientId е определен (било то на новата или на съществуващата съставка), се създава запис в Inventory таблицата чрез _inventoryRepository.AddInventoryItemAsync.
 - [POST] Delete: Премахва съставка от инвентара на потребителя чрез _inventoryRepository.DeleteAync(userId, ingredientId).

-- AI Controller - управлява интеграцията с AI чатбот асистента
 - [GET] Index: Зарежда изгледа, който съдържа потребителския интерфейс на чатбота.
 - [POST] GetChatResponse: Това е Web API ендпойнт, предназначен за AJAX заявки от JavaScript. Приема prompt, очаква JSON данни. Извиква LLMService.
	- Instance.GetSuggestionAsync(model.Prompt), използва Singleton инстанцията. Връща отговор от езиковия модел обратно към клиента, опакован в JSON

-- Home Controller - стандартен, за обслужване на основните страници
 - [GET] Index: Показва началната страница на уебсайта.
 - [GET] Privacy: Показва страницата с политиката за поверителност.
 - [GET] Error: Показва страницата за грешки, която се използва от ExceptionHandling middleware в Program.cs.
